{% schema %}
{
  "name": "Aleem Products Grid",
  "settings": [
    {
    "type": "product",
    "id" : "product_1",
    "label" : "Product 1"
    },{
    "type": "product",
    "id" : "product_2",
    "label" : "Product 2"
    },{
    "type": "product",
    "id" : "product_3",
    "label" : "Product 3"
    },{
    "type": "product",
    "id" : "product_4",
    "label" : "Product 4"
    },{
    "type": "product",
    "id" : "product_5",
    "label" : "Product 5"
    },{
    "type": "product",
    "id" : "product_6",
    "label" : "Product 6"
    }
  ],
  "presets": [
    {
    "name" : "Aleem Products Grid",
    "category" : "Custom Products Grid"
    }
  ]
}
{% endschema %}

<section class="section2 mt-5">
  <div class="container">
    <div class="row text-center text-md-start">
      <div class="col-12">
        <h2>Tisso vison in the wild</h2>
      </div>
    </div>

    <div class="row">
      {% for i in (1..6) %}
        {% assign product_id = 'product_' | append: i %}
        {% assign product = section.settings[product_id] %}
        {% if product %}
          {% assign product = all_products[product] %}
          <div class="col-6 col-md-4 p-2">
            <div class="product-item pos-rel product-grid__item" data-product-handle="{{ product.handle }}">
              <a href="#" class="product-grid__link">
                <img
                  src="{{  product.featured_image | remove_first: 'files/' | file_img_url:'large' }}"
                  alt="{{ product.title }}"
                  width="100%"
                  height="100%"
                >
              </a>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
    <!--
      <div id="product-popup" style="display:none">
        <div class="popup-content">
          <span class="close-popup">&times;</span>
          <h2 id="product-title"></h2>
          <p id="selected-variant-id"></p>
          <button id="popup-add-to-cart">Add to cart</button>
        </div>
      </div>
    -->

    <!-- pop up design -->

    <div id="product-popup" style="display:none">
      <div class="product-item-detail popup-content">
        <span class="close-popup text-end d-block">&times;</span>

        <div class="row">
          <div class="col-6">
            <div class="product-img">
              <img id="product-img" src="" alt="" width="100%" height="100%">
            </div>
          </div>
          <div class="col-6">
            <div class="product-description" id="product-details">
              <h3 id="product-title"></h3>
              <h2 id="product-price"></h2>
              <p id="product-description"></p>
              <p id="selected-variant-id"></p>
            </div>
          </div>
        </div>

        <div class="product-variants">
          <div class="product-variant-item mb-3">
            <h3 class="mb-2">Color</h3>
            <div class="row">
              <div class="col-12">
                <div class="color">
                  <ul id="product-colors">
                    <li class="white">
                      <input type="checkbox" name="color" style="background-color: #fff;">
                      <span>White</span>
                    </li>
                    <li class="black">
                      <input type="checkbox" name="color" style="background-color: #000;">
                      <span>Black</span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="product-variant-item mb-3">
            <h3 class="mb-2">Size</h3>
            <div class="row">
              <div class="col-12">
                <div class="selection-group pos-rel">
                  <select name="" id="product-sizes">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                  </select>
                  <span class="border-right"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button id="popup-add-to-cart" class="add-to-cart-btn mt-4" type="button">ADD TO CART</button>
      </div>
    </div>
  </div>
</section>

{% comment %}
  START OF POP-UP DESIGN
{% endcomment %}

<style>
  #product-popup{
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background-color:rgba(0,0,0,0.4);
    display:flex;
    z-index:1;
    overflow: auto;
  }
  .popup-content{
    background: #fefefe;
    margin: auto;
    padding: 0px 20px 20px 20px;
    border: 1px solid #888;
    width: 30%;
    max-width: 305px;
    position: relative;
    top: 50%;
    transform: translateY(-50%);
  }
  .close-popup {
    font-size: xx-large;
    cursor:pointer;
  }
      .product-img {
        max-height: 140px;
        height: 140px;
      }
      .product-img img {
        width: 100%;
        height: 100%;
      }
      .product-description h3 {
        font-family: 'Jost';
        font-size: 16px;
        line-height: 20px;
        font-weight: 300;
      }
      .product-description h2 {
        font-family: 'Lustria';
        font-size: 16px;
        line-height: 20px;
        font-weight: 400;
      }
      .product-description p {
        font-family: 'Jost';
        font-style: normal;
        font-weight: 300;
        font-size: 12px;
        line-height: 110%;
        letter-spacing: -0.01em;
        color: #000000;
      }
      .product-variant-item h3 {
        font-family: 'Jost';
        font-size: 14px;
        line-height: 19px;
        font-weight: 400;
      }
      .color  ul {
        padding: 0; margin: 0;
        column-count: 2;
        column-gap: 0;
        list-style-type: none;
      }
      .color li {
        height: 40px;
        padding: 0px;
        margin: 0px;
        border: 1px solid black;
        font-family: 'Jost';
        font-size: 18px;
        line-height: 18px;
        letter-spacing: -2%;
        color: black;
        cursor: pointer;
        display: flex;
      }
      .color li span {
        isplay: block;
        width: 5px;
        background: yellow;
        border-right: 1px solid black;
      }
      .color li button {
        width: 100%;
    height: 100%;
    border: 0px;
    background: white;
      }
      .color li input {
        appearance: none;
        border-right: 1px solid black;
        width: 5px;
        height: 100%;
        margin-right: 12px;
      }

      .selected-color button {
        color: #FFF;
        background: #000;
      }
      .product-variant-item select {
        background: url('/');
        background-repeat: no-repeat;
        height: 40px;
        border: 1px solid black;
        width: 100%;
        appearance: none;
        position: relative;
        background-position: right 10px center;
      }
      .product-variant-item .border-right {
        position: absolute;
        right: 50px;
        height: 100%;
        border-right: 1px solid black;
        content: '';
      }
      .add-to-cart-btn {
        background: black;
        color: white;
        border: 1px solid black;
        text-transform: uppercase;
        width: 100%;
        height: 40px;
      }
</style>

{% comment %}
  START OF SCRIPT
{% endcomment %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var product_links = document.querySelectorAll('.product-grid__link');
    var popup = document.getElementById('product-popup');
    var close_popup = document.querySelector('.close-popup');
    var add_to_cart = document.getElementById('popup-add-to-cart');
    var variants =[];

    product_links.forEach(function(link){
      link.addEventListener('click', function(e){
        e.preventDefault();
        var product_handle = this.closest('.product-grid__item').dataset.productHandle;
        //console.log('/products/' + product_handle+ '.js');
        fetch('/products/' + product_handle + '.js')
          .then(response => {
            if (response.ok) {
              return response.json();
            }
          })
        .then(product => {
          console.log(product);
          document.getElementById('product-title').innerText = product.title;
          document.getElementById('product-price').innerText = product.price;
          document.getElementById('product-img').src = product.featured_image;
          document.getElementById('selected-variant-id').innerText = product.variants[0].id;
          var tempDiv = document.createElement('div');
          tempDiv.innerHTML = product.description;
          document.getElementById('product-description').innerText = tempDiv.innerText;

          variants = document.variants;
          // populating color variants
          var colors = product.options[1].values;
          var ul = document.getElementById('product-colors');
          ul.innerHTML = "";
          colors.forEach(function(color){

            var li = '<li class="variant-color">';
                li += '<input type="checkbox" name="color" style="background-color: '+color+';">';
                li += '<span>'+color+'</span>';
                li += '</li>';
            li = '<li><span></span>';
            li += '<button>'+color+'</button></li>';
            ul.innerHTML += li;
          });

          ul.childNodes.forEach(function(li){
            li.addEventListener('click', function(e){
              e.preventDefault();
              document.getElementById('product-colors').childNodes.forEach((li) => li.classList.remove('selected-color'));
              this.classList.add('selected-color');
              });
          });

          // populating size variants
          var sizes = product.options[0].values;
          var options = document.getElementById('product-sizes');
          options.innerHTML = "";
          sizes.forEach(function(size){
            var li = '<option value="'+size+'">'+size+'</option>';
            options.innerHTML += li;
          });
          popup.style.display="block";

        });
      });
    });

    close_popup.addEventListener('click', function(){
      popup.style.display = 'none';
    });

    add_to_cart.addEventListener('click', function() {
      var selected_size = document.getElementById('product-sizes').value;
      //var selected_color = document.
      //var selected = variants.find(variant => variant.option1=='M' && variant.option2=='Black')
      //if
      var variant_id = document.getElementById('selected-variant-id').innerText;
      fetch('/cart/add.js',{
        method: 'POST',
        headers: {
          'Content-type': 'application/json'
        },
        body: JSON.stringify({id: variant_id, quantity:1})
      }).then(response => {
            if (response.ok) {
              return response.json();
            }
          }).then(added_product => {
          //console.log(added_product);
          //var added_product = response.items.find(item => item.variant_id== variant_id);
          //console.log(added_product);
        if (added_product && added_product.variant_options.includes('Black') && added_product.variant_options.includes('XS')){
          console.log('Soft Winter Jacket To be added here');
          fetch ('/products.json')
          .then(response => {
            if (response.ok) {
              return response.json();
            }
            else {
             console.log('some error occurred.');
            }
          }).then(response => {
            const products = response.products;
              //console.log(products);
            if (products) {
              const soft_winter_jacket = products.find(product => product.title == 'Soft Winter Jacket');
              if (soft_winter_jacket) {
                console.log(soft_winter_jacket);
                const medium_black_variant = soft_winter_jacket.variants.find(med => med.option1=='M' && med.option2=='Black')
                if (medium_black_variant) {
                  fetch('/cart/add.js',{
                    method: 'POST',
                    headers: {
                      'Content-type': 'application/json'
                    },
                    body: JSON.stringify({id: medium_black_variant.id, quantity:1})
                  }).then(response => {
                        if (response.ok) {
                          console.log('Soft Winter Jacket Added.');
                        }
                      });
                }

              }
              else {
                console.log('not found');
              }
            }
          });
        }
          popup.style.display="none";

        });

    });
  });
</script>
